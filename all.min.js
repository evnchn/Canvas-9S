debug_mode=false;var ongoing_scan=false;function get_course_id(){splits_url=location.href.split("/");for(var i=0;i<=splits_url.length;i++){if(splits_url[i]&&!isNaN(splits_url[i])){return splits_url[i]}}
return""}
function log_debug(input_log){if(debug_mode){console.log(input_log);}}
var observeDOM=(function(){var MutationObserver=window.MutationObserver||window.WebKitMutationObserver;return function(obj,callback){if(!obj||obj.nodeType!==1)return;if(MutationObserver){var mutationObserver=new MutationObserver(callback)
mutationObserver.observe(obj,{childList:true,subtree:true})
return mutationObserver}
else if(window.addEventListener){obj.addEventListener('DOMNodeInserted',callback,false)
obj.addEventListener('DOMNodeRemoved',callback,false)}}})()
observeDOM(document.body,function(){console.log("body changed");var myATags=document.getElementsByTagName("a");for(var i=0;i<myATags.length;i++){if(myATags[i].innerHTML=='All My Files'){myATags[i].innerHTML="Find 9S for help";myATags[i].classList.add("commschannel")
myATags[i].onclick=function(e){e.preventDefault();if(!ongoing_scan){fetch_all_zip(get_course_id(),function(txt_in){commschannel_elem=document.getElementsByClassName("commschannel")[0];commschannel_elem.innerHTML=txt_in;});}}}}})
function getCookie(cname){let name=cname+"=";let decodedCookie=decodeURIComponent(document.cookie);let ca=decodedCookie.split(';');for(let i=0;i<ca.length;i++){let c=ca[i];while(c.charAt(0)==' '){c=c.substring(1);}
if(c.indexOf(name)==0){return c.substring(name.length,c.length);}}
return"";}
function fetch_all_zip(course_id,output_function=(console.log)){ongoing_scan=true;output_function("Scanning...");fetch('https://canvas.ust.hk/api/v1/courses/'+course_id+'/content_exports',{method:'POST',headers:{'x-csrf-token':getCookie("_csrf_token"),'x-requested-with':'XMLHttpRequest'},body:new URLSearchParams({'export_type':'zip'})}).then((response)=>response.json()).then((data)=>{log_debug(data);function fetch_url_or_log_progress(){const request=new XMLHttpRequest();request.open('GET',data["progress_url"],false);request.setRequestHeader('x-csrf-token',getCookie("_csrf_token"));request.send(null);if(request.status==200){var jsonResponse=JSON.parse(request.responseText);log_debug(jsonResponse);output_function("Scanning: "+jsonResponse.completion+"%");if(jsonResponse.completion==100.0){return true}else{return fetch_url_or_log_progress();}}}
fetch_url_or_log_progress();fetch('https://canvas.ust.hk/api/v1/courses/'+course_id+'/content_exports/'+data["id"],{headers:{'x-csrf-token':getCookie("_csrf_token"),'x-requested-with':'XMLHttpRequest'}}).then((response_final)=>response_final.json()).then((data_final)=>{log_debug(data_final);console.log(data_final.attachment.url);var link=document.createElement('a');link.href=data_final.attachment.url;link.click();output_function("2B-san, hope it helped :)");ongoing_scan=false;});});}
document.head.insertAdjacentHTML("beforeend",`<style>#doc_preview>div{overflow:hidden!important;resize:none!important;height:400px!important;}#doc_preview>div>iframe{min-height:auto!important;}.ic-app-header__logomark-container{display:none;}#logoDiv{display:none;}</style>`);